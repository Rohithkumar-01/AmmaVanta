<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AmmaVanta | Admin Panel</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Poppins', sans-serif; }
  </style>
</head>

<body class="relative min-h-screen bg-gradient-to-br from-green-50 via-emerald-100 to-green-200">

<!-- ğŸ”’ AUTH CHECK -->
<script>
  if (localStorage.getItem("isAdminLoggedIn") !== "true") {
    window.location.href = "login.html";
  }
  function logout() {
    localStorage.removeItem("isAdminLoggedIn");
    window.location.href = "login.html";
  }
</script>

<!-- ğŸŒ¿ BACKGROUND FLOATING BLOBS -->
<div class="absolute inset-0 -z-10 bg-[radial-gradient(circle_at_top_left,rgba(16,185,129,0.35),transparent_45%),radial-gradient(circle_at_bottom_right,rgba(34,197,94,0.35),transparent_45%)]"></div>

<!-- ğŸ” HEADER -->
<header class="sticky top-0 z-30 bg-white/80 backdrop-blur shadow">
  <div class="max-w-7xl mx-auto flex justify-between items-center p-4">
    <h1 class="text-2xl font-bold text-green-700">ğŸŒ¿ AmmaVanta Admin</h1>
    <nav class="space-x-6 text-sm font-semibold">
      <a href="index.html" class="hover:text-green-700">Home</a>
      <a href="menu.html" class="hover:text-green-700">Menu</a>
      <button onclick="logout()" class="text-red-600 hover:underline">Logout</button>
    </nav>
  </div>
</header>

<!-- ğŸ“Œ TITLE -->
<section class="text-center py-10">
  <h2 class="text-4xl font-extrabold text-gray-800">Menu Management</h2>
  <p class="text-gray-600 mt-2">Add & manage restaurant items</p>
</section>

<!-- â• ADD ITEM -->
<section class="max-w-4xl mx-auto bg-white/90 backdrop-blur rounded-3xl shadow-xl p-8">

  <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
    â• Add New Menu Item
  </h3>

  <form id="adminForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">

    <div>
      <label class="text-sm font-semibold">Item Name</label>
      <input id="itemName" required class="w-full border rounded-lg px-4 py-2">
    </div>

    <div>
      <label class="text-sm font-semibold">Price (â‚¹)</label>
      <input id="itemPrice" type="number" required class="w-full border rounded-lg px-4 py-2">
    </div>

    <div>
      <label class="text-sm font-semibold">Category</label>
      <select id="itemCategory" class="w-full border rounded-lg px-4 py-2">
        <option value="">-- Select --</option>
        <option value="starters">ğŸŸ Starters</option>
        <option value="south">ğŸ¥ South Indian</option>
        <option value="north">ğŸ› North Indian</option>
        <option value="desserts">ğŸ® Desserts</option>
        <option value="beverages">â˜• Beverages</option>
      </select>
    </div>

    <!-- SOUTH INDIAN SUB CATEGORY -->
    <div id="subCategoryWrapper" class="hidden">
      <label class="text-sm font-semibold">South Indian Type</label>
      <select id="itemSubCategory" class="w-full border rounded-lg px-4 py-2">
        <option value="">-- Select --</option>
        <option value="tiffins">Breakfast / Tiffins</option>
        <option value="meals">Veg Meals / Thali</option>
        <option value="rice">Rice Items</option>
      </select>
    </div>

    <div>
      <label class="text-sm font-semibold">Rating</label>
      <select id="itemRating" class="w-full border rounded-lg px-4 py-2">
        <option>â­â­â­â­â­</option>
        <option>â­â­â­â­â˜†</option>
        <option>â­â­â­â˜†â˜†</option>
      </select>
    </div>

    <div>
      <label class="text-sm font-semibold">Order Count</label>
      <input id="itemOrders" type="number" value="0" class="w-full border rounded-lg px-4 py-2">
    </div>

    <div class="md:col-span-2">
      <label class="text-sm font-semibold">Upload Image</label>
      <input id="itemImage" type="file" accept="image/*"
             class="w-full border rounded-lg px-4 py-2">
    </div>

    <button class="md:col-span-2 bg-green-600 hover:bg-green-700 text-white py-3 rounded-xl font-semibold transition">
      Add Menu Item
    </button>
  </form>
</section>

<!-- ğŸ“‹ ITEM LIST -->
<section class="max-w-5xl mx-auto mt-14 bg-white/90 backdrop-blur rounded-3xl shadow-xl p-8">
  <h3 class="text-xl font-bold mb-6">ğŸ“‹ Existing Menu Items</h3>
  <ul id="adminItemList" class="space-y-4"></ul>
</section>

<!-- âš™ï¸ SCRIPT -->
<script>
const adminForm = document.getElementById("adminForm");
const adminItemList = document.getElementById("adminItemList");
const itemCategory = document.getElementById("itemCategory");
const subCategoryWrapper = document.getElementById("subCategoryWrapper");

// Show sub-category only for South Indian
itemCategory.onchange = () => {
  subCategoryWrapper.classList.toggle("hidden", itemCategory.value !== "south");
};

adminForm.onsubmit = function (e) {
  e.preventDefault();

  const formData = new FormData();
  formData.append("name", itemName.value);
  formData.append("price", itemPrice.value);
  formData.append("category", itemCategory.value);
  formData.append("subCategory", itemSubCategory?.value || "");
  formData.append("rating", itemRating.value);
  formData.append("orders", itemOrders.value);
  formData.append("image", itemImage.files[0]);

  fetch("http://localhost:3000/menu", {
    method: "POST",
    body: formData
  })
  .then(() => {
    adminForm.reset();
    subCategoryWrapper.classList.add("hidden");
    loadAdminItems();
    alert("âœ… Item added successfully");
  });
};

function loadAdminItems() {
  adminItemList.innerHTML = "";

  fetch("http://localhost:3000/menu")
    .then(res => res.json())
    .then(items => {
      items.forEach(item => {
        adminItemList.innerHTML += `
          <li class="flex justify-between items-center border rounded-xl p-4 hover:shadow transition">
            <div class="flex items-center gap-4">
              <img src="http://localhost:3000/uploads/${item.image || ''}"
                   onerror="this.src='https://via.placeholder.com/60'"
                   class="w-14 h-14 rounded-lg object-cover">

              <div>
                <p class="font-semibold">${item.name}</p>
                <p class="text-sm text-gray-600">
                  â‚¹${item.price} â€¢ ${item.category}
                  ${item.subCategory ? "â€¢ " + item.subCategory : ""}
                </p>
              </div>
            </div>

            <button onclick="deleteItem('${item._id}')"
                    class="text-red-600 hover:underline text-sm">
              Delete
            </button>
          </li>
        `;
      });
    });
}

function deleteItem(id) {
  fetch("http://localhost:3000/menu/" + id, { method: "DELETE" })
    .then(() => loadAdminItems());
}

loadAdminItems();
</script>

</body>
</html>
